<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>traefik notes | Virtualbeck's Blog</title>
<script defer src=https://umami.virtualbeck.com/fetch.js data-website-id=86d77f9c-ba21-4fd6-827a-59469a68d418></script><meta name=keywords content="traefik"><meta name=description content="Maybe this will help you!"><meta name=author content="Mike"><link rel=canonical href=https://blog.virtualbeck.com/posts/traefik/><link crossorigin=anonymous href=/assets/css/stylesheet.734433c881f25f3c96d344436ab83d1b960c84be7e0df7faa81e1e3fd3ddffef.css integrity="sha256-c0QzyIHyXzyW00RDarg9G5YMhL5+Dff6qB4eP9Pd/+8=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.virtualbeck.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.virtualbeck.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.virtualbeck.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.virtualbeck.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.virtualbeck.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.virtualbeck.com/posts/traefik/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="traefik notes"><meta property="og:description" content="Maybe this will help you!"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.virtualbeck.com/posts/traefik/"><meta property="og:image" content="https://blog.virtualbeck.com/static/mike.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-21T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-21T00:00:00+00:00"><meta property="og:site_name" content="virtualbeck's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.virtualbeck.com/static/mike.webp"><meta name=twitter:title content="traefik notes"><meta name=twitter:description content="Maybe this will help you!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.virtualbeck.com/posts/"},{"@type":"ListItem","position":2,"name":"traefik notes","item":"https://blog.virtualbeck.com/posts/traefik/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"traefik notes","name":"traefik notes","description":"Maybe this will help you!\n","keywords":["traefik"],"articleBody":"Maybe this will help you!\nI wanted to take some time to document the work I’ve finally marked off the TODO list; setting up traefik and various services therein. Perhaps this will help you, but really it’s just my attempt get the info posted here so I can reference it later if needed, and move on.\nWhat is traefik? Traefik (pronounced traffic) is a modern HTTP reverse proxy and load balancer that makes deploying microservices easy. \u003c– ripped from github page. I’m using it to host my services (including this page you’re reading now). Some are public, some are private. Some are public behind an auth mechanism. What follows is essentially a dump of my docker-compse.yaml with some secrets/personal obfuscation, with some inline comments to describe what is going on.\nversion: '3.8' services: traefik: image: traefik # Enables the web UI and tells Traefik to listen to docker container_name: \"traefik\" command: - '--api=true' - '--api.dashboard=true' - '--api.insecure=true' - \"--providers.docker=true\" - \"--providers.docker.exposedbydefault=false\" - \"--providers.file.directory=/config/\" - \"--providers.file.watch=true\" - \"--entrypoints.websecure.address=:443\" - \"--certificatesresolvers.myresolver.acme.tlschallenge=true\" - \"--certificatesresolvers.myresolver.acme.email=personal@email.com\" - \"--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json\" - \"--log.level=INFO\" - \"--log.filePath=/logs/traefik.log\" - \"--accesslog=true\" - \"--accesslog.filePath=/logs/access.log\" - \"--accesslog.bufferingsize=50\" ports: - \"8082:8080\" - \"443:443\" volumes: - \"/var/run/docker.sock:/var/run/docker.sock:ro\" - \"./letsencrypt:/letsencrypt\" - \"./logs/:/logs/\" - \"./config/:/config/\" labels: - 'traefik.enable=true' - 'traefik.http.routers.api.rule=Host(`traefik.virtualbeck.com`)' - 'traefik.http.routers.api.entrypoints=websecure' - 'traefik.http.routers.api.service=api@internal' - 'traefik.http.routers.api.tls=true' - 'traefik.http.routers.api.tls.certresolver=myresolver' - 'traefik.http.routers.api.middlewares=authelia@docker' depends_on: - \"authelia\" authelia: # Authentication! image: \"authelia/authelia:4.38.8\" container_name: \"authelia\" restart: unless-stopped expose: - 9091 volumes: - \"~/authelia:/config\" labels: - \"traefik.enable=true\" - \"traefik.http.routers.authelia.rule=Host(`login.virtualbeck.com`)\" - \"traefik.http.routers.authelia.entrypoints=websecure\" - \"traefik.http.routers.authelia.tls.certresolver=myresolver\" - \"traefik.http.routers.authelia.tls=true\" - 'traefik.http.middlewares.authelia.forwardAuth.address=http://authelia:9091/api/verify?rd=https://login.virtualbeck.com/' - 'traefik.http.middlewares.authelia.forwardAuth.trustForwardHeader=true' - 'traefik.http.middlewares.authelia.forwardAuth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Email,Remote-Name' virtualbeck_nginx: # This blog, how recursive! image: nginx:latest container_name: virtualbeck_blog restart: unless-stopped volumes: - \"~/virtualbeck_blog/public:/usr/share/nginx/html:ro\" labels: - \"traefik.enable=true\" - \"traefik.http.routers.virtualbeck_blog.rule=Host(`blog.virtualbeck.com`)\" - \"traefik.http.routers.virtualbeck_blog.entrypoints=websecure\" - \"traefik.http.routers.virtualbeck_blog.tls.certresolver=myresolver\" whoami: # A container that exposes an API to show its IP address image: traefik/whoami container_name: \"whoami\" labels: - \"traefik.enable=true\" - \"traefik.http.routers.whoami.rule=Host(`whoami.virtualbeck.com`)\" - \"traefik.http.routers.whoami.entrypoints=websecure\" - \"traefik.http.routers.whoami.tls.certresolver=myresolver\" - \"traefik.http.routers.whoami.middlewares=authelia\" mini2: # VSCode for my mini2 server, /home/linux/ context image: lscr.io/linuxserver/code-server:latest container_name: \"mini2\" environment: - PUID=1000 - PGID=1000 - TZ=America/Chicago volumes: - \"/home/linux:/linux\" ports: - 8443:8443 restart: unless-stopped labels: - \"traefik.enable=true\" - \"traefik.http.routers.mini2.rule=Host(`mini2.virtualbeck.com`)\" - \"traefik.http.routers.mini2.entrypoints=websecure\" - \"traefik.http.routers.mini2.tls.certresolver=myresolver\" - \"traefik.http.routers.mini2.middlewares=authelia\" #ollama: # # Ollama makes it easy to get up and running with large language models locally. # # Run this docker container on a local server with a gpu, and point open-webui # # at it as the UI # image: ollama/ollama # restart: unless-stopped # ports: # - \"11434:11434\" # volumes: # - \"~/ollama:/root/.ollama\" # #deploy: # # resources: # # reservations: # # devices: # # - driver: nvidia # # count: 1 # # capabilities: [gpu] open-webui: image: ghcr.io/open-webui/open-webui:main container_name: open-webui volumes: - \"~/open-webui:/app/backend/data\" ports: - 3000:8080 environment: - 'OLLAMA_BASE_URL=http://192.168.1.65:11434' #nixos - 'DEFAULT_MODELS=llama3' extra_hosts: - host.docker.internal:host-gateway restart: unless-stopped labels: - \"traefik.enable=true\" - \"traefik.http.routers.ollama.rule=Host(`ollama.virtualbeck.com`)\" - \"traefik.http.routers.ollama.entrypoints=websecure\" - \"traefik.http.routers.ollama.tls.certresolver=myresolver\" - \"traefik.http.routers.ollama.middlewares=authelia\" You can also host a service that is running on another local host with the file provider context. You just mention that, as I did above, and include a matching config file in the directory specified there. Something like this:\n\"--providers.file.directory=/config/\"\nThis way, you can specify the correct IP:PORT for traefik to use, rather than rely on labels. If you try to specify with labels, you will end up with an IP address assigned by docker within the host machine where traefik is running… which is fine if you don’t want things to work. Check this example out:\nhttp: routers: route-to-local-ip: rule: \"Host(`local-service.virtualbeck.com`)\" service: route-to-local-ip-service priority: 1000 entryPoints: - websecure middlewares: - authelia@docker tls: certresolver: - myresolver services: route-to-local-ip-service: loadBalancer: servers: - url: \"http://192.168.1.123:5592\" That’s about it. Thanks for reading, and let me know if you have any questions.\n","wordCount":"590","inLanguage":"en","image":"https://blog.virtualbeck.com/static/mike.webp","datePublished":"2024-06-21T00:00:00Z","dateModified":"2024-06-21T00:00:00Z","author":{"@type":"Person","name":"Mike"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.virtualbeck.com/posts/traefik/"},"publisher":{"@type":"Organization","name":"Virtualbeck's Blog","logo":{"@type":"ImageObject","url":"https://blog.virtualbeck.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.virtualbeck.com/ accesskey=h title="Virtualbeck's Blog (Alt + H)"><img src=https://blog.virtualbeck.com/mike.webp alt aria-label=logo height=36 width=36>Virtualbeck's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.virtualbeck.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.virtualbeck.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.virtualbeck.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://blog.virtualbeck.com/about/ title=About><span>About</span></a></li><li><a href=https://sudoku.virtualbeck.com/ title=Sudoku><span>Sudoku</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://blog.virtualbeck.com/ai_slop/ title=ai_slop><span>ai_slop</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.virtualbeck.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.virtualbeck.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">traefik notes</h1><div class=post-meta><span title='2024-06-21 00:00:00 +0000 UTC'>June 21, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;590 words&nbsp;·&nbsp;Mike&nbsp;|&nbsp;<a href=https://github.com/virtualbeck/website/tree/main/content/posts/traefik.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Maybe this will help you!</p><p>I wanted to take some time to document the work I&rsquo;ve finally marked off the TODO list; setting up <a href=https://github.com/traefik/traefik>traefik</a> and various services therein. Perhaps this will help you, but really it&rsquo;s just my attempt get the info posted here so I can reference it later if needed, and move on.</p><p>What is traefik? <code>Traefik (pronounced traffic) is a modern HTTP reverse proxy and load balancer that makes deploying microservices easy.</code> &lt;&ndash; ripped from github page. I&rsquo;m using it to host my services (including this page you&rsquo;re reading now). Some are public, some are private. Some are public behind an auth mechanism. What follows is essentially a dump of my docker-compse.yaml with some secrets/personal obfuscation, with some inline comments to describe what is going on.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>traefik</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Enables the web UI and tells Traefik to listen to docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;traefik&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;--api=true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;--api.dashboard=true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;--api.insecure=true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--providers.docker=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--providers.docker.exposedbydefault=false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--providers.file.directory=/config/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--providers.file.watch=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--entrypoints.websecure.address=:443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--certificatesresolvers.myresolver.acme.tlschallenge=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--certificatesresolvers.myresolver.acme.email=personal@email.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--log.level=INFO&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--log.filePath=/logs/traefik.log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--accesslog=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--accesslog.filePath=/logs/access.log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--accesslog.bufferingsize=50&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8082:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;443:443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;/var/run/docker.sock:/var/run/docker.sock:ro&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;./letsencrypt:/letsencrypt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;./logs/:/logs/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;./config/:/config/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.enable=true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.routers.api.rule=Host(`traefik.virtualbeck.com`)&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.routers.api.entrypoints=websecure&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.routers.api.service=api@internal&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.routers.api.tls=true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.routers.api.tls.certresolver=myresolver&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.routers.api.middlewares=authelia@docker&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;authelia&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authelia</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Authentication!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;authelia/authelia:4.38.8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;authelia&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expose</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>9091</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;~/authelia:/config&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.enable=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.authelia.rule=Host(`login.virtualbeck.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.authelia.entrypoints=websecure&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.authelia.tls.certresolver=myresolver&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.authelia.tls=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.middlewares.authelia.forwardAuth.address=http://authelia:9091/api/verify?rd=https://login.virtualbeck.com/&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.middlewares.authelia.forwardAuth.trustForwardHeader=true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;traefik.http.middlewares.authelia.forwardAuth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Email,Remote-Name&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>virtualbeck_nginx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># This blog, how recursive!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>virtualbeck_blog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;~/virtualbeck_blog/public:/usr/share/nginx/html:ro&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.enable=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.virtualbeck_blog.rule=Host(`blog.virtualbeck.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.virtualbeck_blog.entrypoints=websecure&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.virtualbeck_blog.tls.certresolver=myresolver&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>whoami</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># A container that exposes an API to show its IP address</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>traefik/whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;whoami&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.enable=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.whoami.rule=Host(`whoami.virtualbeck.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.whoami.entrypoints=websecure&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.whoami.tls.certresolver=myresolver&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.whoami.middlewares=authelia&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mini2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># VSCode for my mini2 server, /home/linux/ context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>lscr.io/linuxserver/code-server:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;mini2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PUID=1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PGID=1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=America/Chicago</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;/home/linux:/linux&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8443</span><span class=p>:</span><span class=m>8443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.enable=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.mini2.rule=Host(`mini2.virtualbeck.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.mini2.entrypoints=websecure&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.mini2.tls.certresolver=myresolver&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.mini2.middlewares=authelia&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#ollama:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  # Ollama makes it easy to get up and running with large language models locally.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  # Run this docker container on a local server with a gpu, and point open-webui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  # at it as the UI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  image: ollama/ollama</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  restart: unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  ports:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#    - &#34;11434:11434&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  volumes:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#    - &#34;~/ollama:/root/.ollama&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #deploy:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #  resources:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #    reservations:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #      devices:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #      - driver: nvidia</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #        count: 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#  #        capabilities: [gpu]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>open-webui</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/open-webui/open-webui:main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>open-webui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;~/open-webui:/app/backend/data&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>3000</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;OLLAMA_BASE_URL=http://192.168.1.65:11434&#39;</span><span class=w> </span><span class=c>#nixos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;DEFAULT_MODELS=llama3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>extra_hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>host.docker.internal:host-gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.enable=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.ollama.rule=Host(`ollama.virtualbeck.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.ollama.entrypoints=websecure&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.ollama.tls.certresolver=myresolver&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.ollama.middlewares=authelia&#34;</span><span class=w>
</span></span></span></code></pre></div><p>You can also host a service that is running on another local host with the <code>file</code> provider context. You just mention that, as I did above, and include a matching config file in the directory specified there. Something like this:</p><p><code>"--providers.file.directory=/config/"</code></p><p>This way, you can specify the <em>correct</em> IP:PORT for traefik to use, rather than rely on labels. If you try to specify with labels, you will end up with an IP address assigned by docker within the host machine where traefik is running&mldr; which is fine if you don&rsquo;t want things to work. Check this example out:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>route-to-local-ip</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Host(`local-service.virtualbeck.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>route-to-local-ip-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>websecure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>authelia@docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>certresolver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>myresolver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>route-to-local-ip-service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>loadBalancer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>servers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://192.168.1.123:5592&#34;</span><span class=w>
</span></span></span></code></pre></div><p>That&rsquo;s about it. Thanks for reading, and let me know if you have any questions.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.virtualbeck.com/tags/traefik/>Traefik</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.virtualbeck.com/>Virtualbeck's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var topButton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(topButton.style.visibility="visible",topButton.style.opacity="1"):(topButton.style.visibility="hidden",topButton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>